"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[738],{49731:(e,n,t)=>{t.d(n,{Z:()=>a});var s=t(1519),i=t.n(s)()((function(e){return e[1]}));i.push([e.id,".chats-wrapper[data-v-5569f3e5]{border-radius:10px;max-width:500px;min-height:40vh;min-width:350px;padding:.5rem;position:relative}@media screen and (max-width:500px){.chats-wrapper[data-v-5569f3e5]{min-width:auto}}.chats-wrapper .title-wrapper[data-v-5569f3e5]{padding-left:.5em}.chats-wrapper ul[data-v-5569f3e5]{list-style:none}.chats-wrapper ul li[data-v-5569f3e5]{border-radius:5px;border-radius:15px;cursor:pointer;display:flex;padding:.5rem .3rem;word-break:break-all}.chats-wrapper ul li .avatar[data-v-5569f3e5]{margin-right:1rem}.chats-wrapper ul li .avatar img[data-v-5569f3e5]{border-radius:50%;width:3em}.chats-wrapper ul li .infos[data-v-5569f3e5]{flex-grow:2}.chats-wrapper ul li .infos .name-unread[data-v-5569f3e5]{align-items:center;display:flex}.chats-wrapper ul li .infos .name-unread .name[data-v-5569f3e5]{font-weight:600;margin-right:1em;max-width:100%}.chats-wrapper ul li .infos .name-unread .unread-messages-count[data-v-5569f3e5]{align-items:center;background-color:purple;border-radius:50%;display:flex;font-size:.55em;font-weight:600;height:1.6em;justify-content:center;width:1.6em}.chats-wrapper ul li .infos .last_message[data-v-5569f3e5]{opacity:.8}.chats-wrapper ul li .infos .unread[data-v-5569f3e5]{color:purple;font-weight:600}.chats-wrapper ul li[data-v-5569f3e5]:hover{background-color:hsla(0,0%,42%,.26)}",""]);const a=i},14738:(e,n,t)=>{t.r(n),t.d(n,{default:()=>m});var s=t(87757),i=t.n(s);function a(e,n,t,s,i,a,r){try{var o=e[a](r),d=o.value}catch(e){return void t(e)}o.done?n(d):Promise.resolve(d).then(s,i)}const r={props:["whoToOpen","amIAlive"],components:{MessageComponent:function(){return t.e(938).then(t.bind(t,37508))}},data:function(){return{currentOpenChat:null,friends:this.$store.getters.getFriends,isLoading:!1}},methods:{close:function(e){if(e){var n=this.friends.findIndex((function(n){return n.id==e.id}));this.friends[n].session.open=!1}this.currentOpenChat=null},openChat:function(e){this.isLoading=!0,e.session?(this.friends.forEach((function(e){return e.session?e.session.open=!1:""})),e.session.open=!0,this.currentOpenChat=e,e.session.unreadCount=0,this.isLoading=!1):this.createSession(e)},createSession:function(e){var n=this;axios.post("/api/sessions/create",{friend_id:e.id}).then((function(t){e.session=t.data,e.session.open=!0,n.currentOpenChat=e,n.isLoading=!1}))},listenForEverySession:function(e){var n=this;window.Echo.private("Chat.".concat(e.session.id)).listen("PrivateChatEvent",(function(t){e.session.open||(n.amIAlive||n.$emit("unread",1),e.session.unreadCount++,e.session.last_message[0].content=t.content)}))}},computed:{isThereASession:function(){return this.friends&&this.friends.length&&this.friends.some((function(e){return e.session}))}},created:function(){var e,n=this;return(e=i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.whoToOpen&&(n.openChat(n.friends.find((function(e){return e.id==n.whoToOpen}))),n.$emit("chatOpened")),n.friends.forEach((function(e){n.listenForEverySession(e)})),t=n.friends.reduce((function(e,n){return e+n.session.unreadCount}),0),n.amIAlive||n.$emit("unread",t),window.Echo.channel("Chat").listen("HearingEvent",(function(e){var t=n.friends.find((function(n){return n.id==e.user_id}));t&&(t.isPlaying=e.is_playing)})),window.Echo.channel("Chat").listen("SessionEvent",(function(e){n.friends.find((function(n){return n.id==e.session_by})).session=e.session}));case 6:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(s,i){var r=e.apply(n,t);function o(e){a(r,s,i,o,d,"next",e)}function d(e){a(r,s,i,o,d,"throw",e)}o(void 0)}))})()},watch:{whoToOpen:function(e){e&&(this.openChat(this.friends.find((function(n){return n.id==e}))),this.$emit("chatOpened"))},amIAlive:function(e){e||this.close(this.currentOpenChat)}}};var o=t(93379),d=t.n(o),c=t(49731),u={insert:"head",singleton:!1};d()(c.Z,u);c.Z.locals;var l=t(51900),h=t(43453),p=t.n(h),f=t(85893),v=(0,l.Z)(r,(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("v-card",{staticClass:"chats-wrapper absolute-panel",attrs:{rounded:"lg"}},[t("div",{staticClass:"card-title-medium"},[e._v(e._s(e.$t("Chats")))]),e._v(" "),e.isLoading?t("div",{staticClass:"loading"},[e._v(e._s(e.$t("Opening chat...Please wait!")))]):t("div",{staticClass:"chats"},[e.isThereASession?t("ul",[e._l(e.friends,(function(n){return[n.session?t("li",{key:n.id,on:{click:function(t){return e.openChat(n)}}},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:n.avatar,alt:""}})]),e._v(" "),t("div",{staticClass:"infos"},[t("div",{staticClass:"name-unread"},[t("div",{staticClass:"name max-1-lines"},[e._v(e._s(n.name))]),e._v(" "),n.session.unreadCount>0?t("div",{staticClass:"unread-messages-count"},[e._v("\n                                "+e._s(n.session.unreadCount)+"\n                            ")]):e._e()]),e._v(" "),n.session.last_message.length?t("div",{staticClass:"last_message",class:{unread:n.session.unreadCount>0}},[e._v("\n                            "+e._s(n.session.last_message[0].content)+"\n                        ")]):e._e()])]):e._e()]}))],2):t("empty-page",{attrs:{headline:e.$t("No chats to show!"),sub:e.$t("Add some friends and start chatting!")}})],1),e._v(" "),e.currentOpenChat?[t("message-component",{attrs:{friend:e.currentOpenChat},on:{close:function(n){return e.close(e.currentOpenChat)}}})]:e._e()],2)}),[],!1,null,"5569f3e5",null);const m=v.exports;p()(v,{VCard:f.Z})}}]);